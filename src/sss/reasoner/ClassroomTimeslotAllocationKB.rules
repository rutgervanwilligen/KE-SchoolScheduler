package sss.reasoner;

import sss.scheduler.objects.SingleHourLesson;
import sss.scheduler.objects.Subject;
import sss.scheduler.objects.Schedule;
import sss.scheduler.objects.Teacher;
import sss.scheduler.objects.LessonHour;
import sss.scheduler.objects.Classroom;
import sss.scheduler.objects.Availability;
import sss.scheduler.objects.ClassInSchool;

/**
 * Rule base used to allocate a lesson object to a classroom and time slot.
 */
public ruleBase ClassroomTimeslotAllocationKB {
  
  rule allocationRule1 {
    declarations
      Schedule schedule;
  	  SingleHourLesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	  Teacher teacher;
  	localdecl
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subjectOfLesson = lessonToAllocate.getSubject();
    conditions
  	  schedule.containsLessonInSchedulingSet(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.isAllocatedToTimeslot(); // Eigenlijk overbodig
  	  
  	  classroom.isAvailable(hour);
  	  classroom.isSuitedFor(subjectOfLesson);
  	  classToAllocate.isAvailable(hour);
  	  teacher.getAvailability(hour) == Availability.AVAILABLE;
      teacher.getScheduledValue(hour) == Availability.AVAILABLE;
    actions
      System.out.println("allocationRule1 fired");
  	  schedule.scheduleSingleHourLesson(lessonToAllocate, classroom, hour);
  	  classroom.setToUnavailable(hour);
  	  classToAllocate.setToUnavailable(hour);
  	  teacher.setToUnavailable(hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }
  
  rule allocationRule2 {
    declarations
      Schedule schedule;
  	  SingleHourLesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	  Teacher teacher;
  	localdecl
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subjectOfLesson = lessonToAllocate.getSubject();
  	  String subjectName = lessonToAllocate.getSubject().getCode();
    conditions
  	  schedule.containsLessonInSchedulingSet(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.isAllocatedToTimeslot(); // Eigenlijk overbodig
  	  
  	  !subjectName.equals("LO");
  	  !subjectName.equals("HV");
  	  !subjectName.equals("IN");
  	  classroom.isAvailable(hour);
  	  !classroom.isSuitedFor(subjectOfLesson);
  	  classroom.isSuitedForGeneralUse();
  	  classToAllocate.isAvailable(hour);
  	  teacher.getAvailability(hour) == Availability.AVAILABLE;
      teacher.getScheduledValue(hour) == Availability.AVAILABLE;
    actions
      System.out.println("allocationRule1 fired");
  	  schedule.scheduleSingleHourLesson(lessonToAllocate, classroom, hour);
  	  classroom.setToUnavailable(hour);
  	  classToAllocate.setToUnavailable(hour);
  	  teacher.setToUnavailable(hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }
  
}