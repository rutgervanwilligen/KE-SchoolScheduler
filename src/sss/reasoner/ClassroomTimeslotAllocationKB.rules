package sss.reasoner;

import sss.scheduler.objects.Lesson;
import sss.scheduler.objects.Subject;
import sss.scheduler.objects.Schedule;
import sss.scheduler.objects.Teacher;
import sss.scheduler.objects.LessonHour;
import sss.scheduler.objects.Classroom;
import sss.scheduler.properties.Availability;
import sss.scheduler.objects.ClassInSchool;

/**
 * Rule base used to allocate a lesson object to a classroom and time slot.
 */
public ruleBase ClassroomTimeslotAllocationKB {

/* 
 * Allocation rule, class doesn't have this subject at the same day
 * and teacher is already allocated to the classroom right before or after this hour
 */
  rule allocationRule1 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subject = lessonToAllocate.getSubject();
    conditions
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  schedule.teacherAlreadyScheduledInClassroomRightBeforeOrAfter(teacher, classroom, hour);
  	  !schedule.subjectAlreadyAllocatedToClassOnWeekday(subject, hour, classToAllocate);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule1 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }


/* 
 * Allocation rule, class doesn't have this subject at the same day
 * and teacher has already been in the classroom that day 
 */
  rule allocationRule2 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subject = lessonToAllocate.getSubject();
    conditions
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  schedule.teacherAlreadyScheduledInClassroomOnWeekday(teacher, classroom, hour);
  	  !schedule.subjectAlreadyAllocatedToClassOnWeekday(subject, hour, classToAllocate);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule2 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }
  
/* 
 * Allocation rule, class doesn't have this subject at the same day
 * and classroom is suited specially for this lesson
 */
  rule allocationRule3 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
  	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subject = lessonToAllocate.getSubject();
    conditions
  	  teacher.isSuitedFor(lessonToAllocate);
  	  !schedule.subjectAlreadyAllocatedToClassOnWeekday(subject, hour, classToAllocate);
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  classroom.isSuitedFor(lessonToAllocate);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule3 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }


/* 
 * Allocation rule, class doesn't have this subject at the same day
 * and put lesson in classroom for general use 
 */
  rule allocationRule4 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subject = lessonToAllocate.getSubject();
    conditions
  	  !classroom.isSuitedFor(lessonToAllocate);
  	  !lessonToAllocate.needsSpecialClassroom(); 
  	  !schedule.subjectAlreadyAllocatedToClassOnWeekday(subject, hour, classToAllocate); 
  	  classroom.isSuitedForGeneralUse();
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule4 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  } 

/* 
 * Allocation rule, subject without homework on a day where such subjects aren't allocated yet,
 * and teacher is already allocated to the classroom right before or after this hour
 */
   rule allocationRule5 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subject = lessonToAllocate.getSubject();
    conditions
  	  !subject.requiresHomework();
  	  schedule.noClassesWithoutHomeworkOnWeekday(classToAllocate, hour);
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  schedule.teacherAlreadyScheduledInClassroomRightBeforeOrAfter(teacher, classroom, hour);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule5 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }

  
/* 
 * Allocation rule, subject without homework on a day where such subjects aren't allocated yet,
 * teacher has already been in the classroom that day 
 */
   rule allocationRule6 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subject = lessonToAllocate.getSubject();
    conditions
  	  !subject.requiresHomework();
  	  schedule.noClassesWithoutHomeworkOnWeekday(classToAllocate, hour);
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  schedule.teacherAlreadyScheduledInClassroomOnWeekday(teacher, classroom, hour);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule6 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }
  
/* 
 * Allocation rule, subject without homework on a day where such subjects aren't allocated yet,
 * classroom is suited specially for this lesson
 */
   rule allocationRule7 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
  	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subject = lessonToAllocate.getSubject();
    conditions
  	  teacher.isSuitedFor(lessonToAllocate);
  	  !subject.requiresHomework();
  	  schedule.noClassesWithoutHomeworkOnWeekday(classToAllocate, hour);
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  classroom.isSuitedFor(lessonToAllocate);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule7 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }
 
/* 
 * Allocation rule, subject without homework on a day where such subjects aren't allocated yet,
 * put lesson in classroom for general use 
 */ 
  rule allocationRule8 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  Subject subject = lessonToAllocate.getSubject();
    conditions
  	  !subject.requiresHomework();
  	  schedule.noClassesWithoutHomeworkOnWeekday(classToAllocate, hour);
  	  !classroom.isSuitedFor(lessonToAllocate);
  	  !lessonToAllocate.needsSpecialClassroom();  
  	  classroom.isSuitedForGeneralUse();
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule8 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }

/* Allocation rule, teacher is already allocated to the classroom right before or after this hour */
  rule allocationRule9 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
    conditions
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  schedule.teacherAlreadyScheduledInClassroomRightBeforeOrAfter(teacher, classroom, hour);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule9 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }

/* Allocation rule, teacher has already been in the classroom that day */
  rule allocationRule10 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
    conditions
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  schedule.teacherAlreadyScheduledInClassroomOnWeekday(teacher, classroom, hour);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule10 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }

/* Allocation rule, classroom is suited specially for this lesson */
  rule allocationRule11 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
  	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
    conditions
  	  teacher.isSuitedFor(lessonToAllocate);
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  classroom.isSuitedFor(lessonToAllocate);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule11 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }


/* Allocation rule, put lesson in classroom for general use */
  rule allocationRule12 {
    declarations
      Schedule schedule;
  	  Lesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
    conditions
  	  !classroom.isSuitedFor(lessonToAllocate);
  	  !lessonToAllocate.needsSpecialClassroom();  
  	  classroom.isSuitedForGeneralUse();
  	  classroom.isAvailable(hour, lessonToAllocate);
  	  classToAllocate.isAvailable(hour, lessonToAllocate);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, lessonToAllocate);
      !teacher.isScheduled(hour, lessonToAllocate);
    actions
      // System.out.println("allocationRule12 fired");
  	  schedule.scheduleLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }
}
