package sss.reasoner;

import sss.scheduler.objects.SingleHourLesson;
import sss.scheduler.objects.DoubleHourLesson;
import sss.scheduler.objects.Subject;
import sss.scheduler.objects.Schedule;
import sss.scheduler.objects.Teacher;
import sss.scheduler.objects.LessonHour;
import sss.scheduler.objects.Classroom;
import sss.scheduler.properties.Availability;
import sss.scheduler.objects.ClassInSchool;

/**
 * Rule base used to allocate a lesson object to a classroom and time slot.
 */
public ruleBase ClassroomTimeslotAllocationKB {

/* Allocation rule for double hour, teacher has already been in the classroom that day */
  rule allocationRule1 {
    declarations
      Schedule schedule;
  	  DoubleHourLesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  LessonHour nextHour = hour.getNextHour();
    conditions
  	  schedule.containsLessonInSchedulingSet(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.isAllocatedToTimeslot(); // Eigenlijk overbodig
  	  hour.hasNextHour();
  	  classroom.isAvailable(hour, true);
  	  schedule.teacherAlreadyScheduledInClassroomOnWeekday(teacher, classroom, hour);
  	  classToAllocate.isAvailable(hour, true);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, true);
      !teacher.isScheduled(hour, true);
    actions
      System.out.println("allocationRule1 fired");
  	  schedule.scheduleDoubleHourLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour, nextHour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }

/* Allocation rule for double hour, classroom is suited specially for this lesson */
  rule allocationRule2 {
    declarations
      Schedule schedule;
  	  DoubleHourLesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
  	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  LessonHour nextHour = hour.getNextHour();
    conditions
  	  schedule.containsLessonInSchedulingSet(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.isAllocatedToTimeslot(); // Eigenlijk overbodig
  	  hour.hasNextHour();
  	  teacher.isSuitedFor(lessonToAllocate);
  	  classroom.isAvailable(hour, true);
  	  classroom.isSuitedFor(lessonToAllocate);
  	  classToAllocate.isAvailable(hour, true);
  	  teacher.isAvailable(hour, true);
      !teacher.isScheduled(hour, true);
    actions
      System.out.println("allocationRule2 fired");
  	  schedule.scheduleDoubleHourLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour, nextHour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }


/* Allocation rule for double hour, when teacher hasn't been in a room before */
  rule allocationRule3 {
    declarations
      Schedule schedule;
  	  DoubleHourLesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
   	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  LessonHour nextHour = hour.getNextHour();
    conditions
  	  schedule.containsLessonInSchedulingSet(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.isAllocatedToTimeslot(); // Eigenlijk overbodig
  	  hour.hasNextHour();
  	  !classroom.isSuitedFor(lessonToAllocate);
  	  !lessonToAllocate.needsSpecialClassroom();  
  	  classroom.isSuitedForGeneralUse();
  	  classroom.isAvailable(hour, true);
  	  classToAllocate.isAvailable(hour, true);
  	  teacher.isSuitedFor(lessonToAllocate);
  	  teacher.isAvailable(hour, true);
      !teacher.isScheduled(hour, true);
    actions
      System.out.println("allocationRule3 fired");
  	  schedule.scheduleDoubleHourLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour, nextHour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }

/* Allocation rule for single hour, teacher has visited the classroom on the same day already */
  rule allocationRule4 {
    declarations
      Schedule schedule;
  	  SingleHourLesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
  	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
    conditions
  	  schedule.containsLessonInSchedulingSet(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.isAllocatedToTimeslot(); // Eigenlijk overbodig
  	  teacher.isSuitedFor(lessonToAllocate);
  	  classroom.isAvailable(hour, false);
  	  schedule.teacherAlreadyScheduledInClassroomOnWeekday(teacher, classroom, hour);
  	  classToAllocate.isAvailable(hour, false);
  	  teacher.isAvailable(hour, false);
      !teacher.isScheduled(hour, false);
    actions
      System.out.println("allocationRule4 fired");
  	  schedule.scheduleSingleHourLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }

/* Allocation rule for single hour, classroom is suited specially for this lesson */
  rule allocationRule5 {
    declarations
      Schedule schedule;
  	  SingleHourLesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
  	  Teacher teacher = lessonToAllocate.getTeacher();
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
    conditions
  	  schedule.containsLessonInSchedulingSet(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.isAllocatedToTimeslot(); // Eigenlijk overbodig
  	  teacher.isSuitedFor(lessonToAllocate);
  	  classroom.isAvailable(hour, false);
  	  classroom.isSuitedFor(lessonToAllocate);
  	  classToAllocate.isAvailable(hour, false);
  	  teacher.isAvailable(hour, false);
      !teacher.isScheduled(hour, false);
    actions
      System.out.println("allocationRule5 fired");
  	  schedule.scheduleSingleHourLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }
  
/* Allocation rule for single hour, lesson can be given in general use classroom */
  rule allocationRule6 {
    declarations
      Schedule schedule;
  	  SingleHourLesson lessonToAllocate;
  	  Classroom classroom;
  	  LessonHour hour;
  	localdecl
  	  ClassInSchool classToAllocate = lessonToAllocate.getClassInSchool();
  	  String subjectName = lessonToAllocate.getSubject().getCode();
  	  Teacher teacher = lessonToAllocate.getTeacher();
    conditions
  	  schedule.containsLessonInSchedulingSet(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.isAllocatedToTimeslot(); // Eigenlijk overbodig
  	  teacher.isSuitedFor(lessonToAllocate); // Eigenlijk overbodig
  	  !lessonToAllocate.needsSpecialClassroom();
  	  classroom.isAvailable(hour, false);
  	  !classroom.isSuitedFor(lessonToAllocate);
  	  classroom.isSuitedForGeneralUse();
  	  classToAllocate.isAvailable(hour, false);
  	  teacher.isAvailable(hour, false);
      !teacher.isScheduled(hour, false);
    actions
      System.out.println("allocationRule6 fired");
  	  schedule.scheduleSingleHourLesson(lessonToAllocate, classroom, classToAllocate, teacher, hour);
  	  modified(schedule);
  	  modified(classroom);
  	  modified(classToAllocate);
  	  modified(teacher);
  	  retract(lessonToAllocate);
  }
  
}
