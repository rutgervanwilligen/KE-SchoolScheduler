package sss.reasoner;

import sss.scheduler.objects.Lesson;
import sss.scheduler.objects.Schedule;

/**
 * Rule base used to select lessons.
 */
public ruleBase LessonSelectionKB {

  rule lessonSelection1 {
  /* Select lesson with lowest availability count */
    declarations
      Lesson lesson;
      Schedule schedule;
    localdecl
      Integer lowestAvailabilityCount = schedule.lowestAvailabilityCount();
    conditions
      schedule.schedulingSetIsEmpty();
      schedule.containsUnallocatedLesson(lesson);
      schedule.singleLowestAvailabilityCount();
      
      !lesson.isAllocatedToTimeslot();
      lesson.getAvailabilityCount() == lowestAvailabilityCount;
    actions
      // System.out.println("lessonSelection1 fired");
	  schedule.addToSchedulingSet(lesson);
      modified(schedule);
      retract(lesson);
  }

  rule lessonSelection2 {
  /* If multiple lessons have lowest count, select LO, HV or IN */
    declarations
      Lesson lesson;
      Schedule schedule;
    localdecl
      Integer lowestAvailabilityCount = schedule.lowestAvailabilityCount();
    conditions
      schedule.schedulingSetIsEmpty();
      schedule.containsUnallocatedLesson(lesson);
      !schedule.singleLowestAvailabilityCount();
      
      !lesson.isAllocatedToTimeslot();
      lesson.getAvailabilityCount() == lowestAvailabilityCount;
      lesson.getSubject().getCode().equals("LO");
    actions
      // System.out.println("lessonSelection2 fired");
	  schedule.addToSchedulingSet(lesson);
      modified(schedule);
      retract(lesson);
  }

  rule lessonSelection3 {
  /* If multiple lessons have lowest count, select LO, HV or IN */
    declarations
      Lesson lesson;
      Schedule schedule;
    localdecl
      Integer lowestAvailabilityCount = schedule.lowestAvailabilityCount();
    conditions
      schedule.schedulingSetIsEmpty();
      schedule.containsUnallocatedLesson(lesson);
      !schedule.singleLowestAvailabilityCount();
      
      !lesson.isAllocatedToTimeslot();
      lesson.getAvailabilityCount() == lowestAvailabilityCount;
      lesson.getSubject().getCode().equals("HV");
    actions
      // System.out.println("lessonSelection3 fired");
	  schedule.addToSchedulingSet(lesson);
      modified(schedule);
      retract(lesson);
  }

  rule lessonSelection4 {
  /* If multiple lessons have lowest count, select LO, HV or IN */
    declarations
      Lesson lesson;
      Schedule schedule;
    localdecl
      Integer lowestAvailabilityCount = schedule.lowestAvailabilityCount();
    conditions
      schedule.schedulingSetIsEmpty();
      schedule.containsUnallocatedLesson(lesson);
      !schedule.singleLowestAvailabilityCount();
      
      !lesson.isAllocatedToTimeslot();
      lesson.getAvailabilityCount() == lowestAvailabilityCount;
      lesson.getSubject().getCode().equals("IN");
    actions
      // System.out.println("lessonSelection4 fired");
	  schedule.addToSchedulingSet(lesson);
      modified(schedule);
      retract(lesson);
  }

  rule lessonSelection5 {
  /* If multiple lessons have lowest count and no special course is left, select any course. */
    declarations
      Lesson lesson;
      Schedule schedule;
    localdecl
      Integer lowestAvailabilityCount = schedule.lowestAvailabilityCount();
    conditions
      schedule.schedulingSetIsEmpty();
      schedule.containsUnallocatedLesson(lesson);
      !schedule.singleLowestAvailabilityCount();
      
      !lesson.isAllocatedToTimeslot();
      lesson.getAvailabilityCount() == lowestAvailabilityCount;
    actions
      // System.out.println("lessonSelection5 fired");
	  schedule.addToSchedulingSet(lesson);
      modified(schedule);
      retract(lesson);
  }

}